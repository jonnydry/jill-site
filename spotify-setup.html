<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Spotify Setup - Jill Site</title>
  <style>
    body {
      background: #0a0a0a;
      color: #e8e8e8;
      font-family: system-ui, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 2rem;
    }
    .container {
      max-width: 500px;
      text-align: center;
    }
    h1 { color: #ff69b4; }
    .btn {
      background: #1DB954;
      color: #000;
      border: none;
      padding: 1rem 2rem;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      margin: 1rem 0;
    }
    .btn:hover { transform: scale(1.05); }
    .token-box {
      background: #1a1a1a;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      word-break: break-all;
      font-family: monospace;
      font-size: 0.85rem;
      border: 1px solid #333;
    }
    .steps {
      text-align: left;
      background: #1a1a1a;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1.5rem 0;
    }
    .steps li { margin: 0.5rem 0; }
    code {
      background: #333;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéµ Spotify Setup</h1>
    <p>One-time setup to enable "Now Playing" on your Mood page.</p>
    
    <div id="step-1">
      <button class="btn" onclick="startAuth()">Connect Spotify Account</button>
      <p style="color:#666;font-size:0.85rem;">You'll authorize read-only access to your currently playing track.</p>
    </div>
    
    <div id="step-2" style="display:none;">
      <h2>‚úÖ Authorization Complete!</h2>
      <p>Copy this refresh token and add it to Vercel:</p>
      <div class="token-box" id="refresh-token"></div>
      <button class="btn" onclick="copyToken()">Copy Token</button>
      
      <div class="steps">
        <h3>Next Steps:</h3>
        <ol>
          <li>Go to <a href="https://vercel.com/dashboard" style="color:#ff69b4;">vercel.com/dashboard</a></li>
          <li>Select your <code>jill-site</code> project</li>
          <li>Go to Settings ‚Üí Environment Variables</li>
          <li>Add: <code>SPOTIFY_REFRESH_TOKEN</code> = (paste token above)</li>
          <li>Add: <code>SPOTIFY_CLIENT_SECRET</code> = your client secret</li>
          <li>Click Save ‚Üí Redeploy</li>
        </ol>
      </div>
      
      <a href="mood.html" style="color:#ff69b4;">‚Üê Back to Mood Page</a>
    </div>
  </div>

  <script>
    const CLIENT_ID = 'cf26eec6b65f463a9832d4c696752c58';
    const REDIRECT_URI = window.location.origin + '/spotify-setup.html';
    
    function startAuth() {
      const scopes = 'user-read-currently-playing user-read-playback-state';
      const url = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=code&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(scopes)}&show_dialog=true`;
      window.location.href = url;
    }
    
    // Check for auth code in URL
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const error = params.get('error');
    
    if (error) {
      alert('Authorization failed: ' + error);
    }
    
    if (code) {
      // Exchange code for tokens (this needs to be done server-side with client secret)
      document.getElementById('step-1').style.display = 'none';
      document.getElementById('step-2').style.display = 'block';
      document.getElementById('refresh-token').textContent = 
        'Authorization code received. Now exchange this for tokens using your client secret.\n\n' +
        'Code: ' + code + '\n\n' +
        'Run this curl command locally:\n' +
        'curl -X POST https://accounts.spotify.com/api/token \\\n' +
        '  -H "Content-Type: application/x-www-form-urlencoded" \\\n' +
        '  -d "grant_type=authorization_code" \\\n' +
        '  -d "code=' + code + '" \\\n' +
        '  -d "redirect_uri=' + REDIRECT_URI + '" \\\n' +
        '  -d "client_id=' + CLIENT_ID + '" \\\n' +
        '  -d "client_secret=YOUR_CLIENT_SECRET"';
    }
    
    function copyToken() {
      const token = document.getElementById('refresh-token').textContent;
      navigator.clipboard.writeText(token);
      alert('Copied! Now add it to Vercel environment variables.');
    }
  </script>
</body>
</html>
